<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <title>MEDIAR</title>
    <LINK type="text/css" rel="stylesheet" href="styles/layout-default-latest.css" />

    <link rel="stylesheet"  type="text/css"  href="lib/font-awesome/css/font-awesome.min.css">
	
    <script type="text/javascript" src="lib/jquery.js"></script>
    <script type="text/javascript" src="lib/math.js"></script>
    <script type="text/javascript" src="lib/jquery.layout.js"></script>
    <script type="text/javascript" src="lib/jquery.ui.all.js"></script>
    <script type="text/javascript" src="lib/jquery-latest.js"></script>
    <script type="text/javascript" src="lib/jquery-ui-latest.js"></script>
    <script type="text/javascript" src="lib/jquery.layout-1.3.0.rc30.80.js"></script>


    <link rel="stylesheet" type="text/css" href="styles/style.css"/>
    <link rel="stylesheet" type="text/css" href="styles/zoom_style.css"/>
    <link rel="stylesheet" type="text/css" href="styles/galaxy_style.css"/>

    <script type="text/javascript" src="lib/d3.min.js"></script>
    <script type="text/javascript" src="lib/d3-ForceEdgeBundling.js"></script>
    <script type="text/javascript" src="lib/isotope.pkgd.min.js"></script>
    <script type="text/javascript" src="lib/queue.min.js"></script>
    <script type="text/javascript" src="https://rawgit.com/marcj/css-element-queries/master/src/ResizeSensor.js"></script>
    <script type="text/javascript" src="https://rawgit.com/marcj/css-element-queries/master/src/ElementQueries.js"></script>
    <!-- <script type="text/javascript"src="https://d3js.org/d3.v4.min.js"></script> -->



    <script type="text/javascript">
	/********** Below code is taken and modified for the layout maximize button*/
	/*// a var is required because this page utilizes: myLayout.allowOverflow() method*/
	var myLayout; 

	function toggleMaximize ( paneName, cbPane ) {
		var	pane		= cbPane || paneName
			$Pane		= myLayout.panes[ pane ]
		,	state		= myLayout.state
		,	s			= state[ pane ]
		,	container	= state.container
		,	isMaximized	= null
		,	panePaddingAndBorderHeight = s.outerHeight - s.css.height
		,	panePaddingAndBorderWidth  = s.outerWidth  - s.css.width
		;
		if (pane==="south") {
			// console.log(s.css.height, panePaddingAndBorderHeight)
			if ($Pane.height() == s.css.height) {
				$Pane.css({
					height:	container.innerHeight- panePaddingAndBorderHeight //-135
				,	zIndex:	3
				});
				isMaximized = true;
			}
			else { // RESET pane to what state says it *should be*
				$Pane.css({
					height:	s.css.height
				,	zIndex:	1
				});
				isMaximized = false;
			}
		}
		else if (pane==="east" || pane==="west") {
			if ($Pane.width() == s.css.width) {
				s.top = $Pane.css("top"); // save value | TODO: add top/bottom/left/right to state.pane.css data
				// console.log(s.top)
				$Pane.css({
				/*	need to also set top & height if want to cover north/south panes
				   if only want to cover west-center-east panes, then DO NOT set top or height!
					top:	container.insetTop,*/

					// top:80,
					height:	container.innerHeight - 20- panePaddingAndBorderHeight, //-120
					width:	container.innerWidth  - 20 - panePaddingAndBorderWidth
				,	zIndex:	3
				});
				isMaximized = true;
			}
			else { /*RESET pane to what state says it *should be**/ 
				$Pane.css({
					top:	s.top
				,	height:	s.css.height
				,	width:	s.css.width
				,	zIndex:	1
				});
				isMaximized = false;
			}
		}
		/*if no valid pane was passed, then exit now*/
		if (isMaximized === null) return;

		/*set flags so can check a pane's state to see if it is 'maximized'*/
		s.maximized = isMaximized;
		/*set var for use by onresizeall callback to re-maximize pane after window.resize*/
		container.maximizedPane = isMaximized ? pane : '';

		/*OPTIONALLY show/hide all other panes in Layout*/
		for (var i=0; i<5; i++) {
			var name = $.layout.config.allPanes[ i ]
			,	$P = myLayout.panes[ name ];
			if (!$P || name == pane) continue; // SKIP un/maximized pane
			if (isMaximized && $P.is(":visible")) {
				state[ name ].hiddenByMaximize  = true; // set a state-flag
				$P.css("visibility", "hidden"); // make pane invisible
				if (name !== "center")
					myLayout.resizers[ name ].hide(); // ditto for its resizer-bar
			}
			else if (!isMaximized && state[ name ].hiddenByMaximize ) {
				state[ name ].hiddenByMaximize  = false; // clear flag
				$P.css("visibility", "visible"); // reset visibility
				if (name !== "center")
					myLayout.resizers[ name ].show(); // ditto for its resizer-bar
			}
		}

		// if maximized, add events to catch pane.close or resizeAll, which UN-maximize the pane
		if (isMaximized) {
			$Pane.bind("layoutpaneonclose_start.toggleMaximize", toggleMaximize)
				.bind("layoutpaneonresize_start.toggleMaximize", toggleMaximize);
				// TODO: pane.onresize is not reliably firing when layout resized
				//		try adding a callback to layoutonresize_start as well, pane = state.container.maximizedPane
		}
		else {
			// remove events (above) added when pane was maximized
			$Pane.unbind(".toggleMaximize");
		}
	};

	$(document).ready(function () {
		myLayout = $('body').layout({
			south:{size:150},
			north__resizable: false
			// ,south:{state:close}
			,onresizeall:  function (Instance, state) { toggleMaximize( state.container.maximizedPane ); }
		});
		myLayout.close("south")

		myLayout
			.bindButton('#toggleAllPanes', 'toggle', 'west')
			.bindButton('#toggleAllPanes', 'toggle', 'east')

 	});
    </script>
    <style type="text/css">
	/**
	 *	Basic Layout Theme
	 *  This theme uses the default layout class-names for all classes
	 *	Add any 'custom class-names', from options: paneClass, resizerClass, togglerClass
	 */
		.ui-layout-pane { /* all 'panes' */ 
			background: #FFF; 
			border: 1px solid #BBB; 
			padding: 10px; 
			overflow: auto;
		} 

		.ui-layout-resizer { /* all 'resizer-bars' */ 
			background: #0a0a67; 
		} 

		.ui-layout-toggler-hover { /* all 'resizer-bars' */ 
			background: #016c59!important;
		} 

		.ui-layout-toggler { /* all 'toggler-buttons' */ 
			background: #AAA; 
		} 
		/* !important is used to override any parental properies or properties defined in some other css*/
		.ui-layout-north{
			background-color: #0a0a67;
			z-index:100 !important;
			visibility: visible !important;
			color:white !important;
			height: 80px;
			overflow: hidden !important;
			font-size: 16px !important ;
		}
		
		#headerWrapper{
			display: flex;
  			align-items: stretch;
		}

		.headerBoxes{
			flex:1;
			margin-right:10px;
			padding:10px;
			
		}
		
	</style>
</head>
<body>


<!-- below ui-layouts sets each of the panel and its buttons -->
	<div class="ui-layout-north">
		<div id="headerWrapper">
			<div id= "selection_menu" class="headerBoxes" style="background-color:transparent;">  		
				<div id="buttons_id" style="width:195px; ">
					<span style="font-weight:bold; color:black !important; font-size:14px;padding: 0px 10px;"> Select Drugs</span> 
					<button id ="reset_button" type="button">Reset</button>
				</div>
					<select multiple id="drugs_menu"> </select>
			</div>	                  

			<!-- <div style="float:left">  -->
			<div class="headerBoxes">
				<p class= "white_color" style= "-webkit-margin-after:0px !important;-webkit-margin-before:0px !important; margin-left:5px;"> Filter DDIs:  </p>	
					<input  type="radio" name="filter" value="known"> <label for="option">Known DIARs</label> <br>
					<input  type="radio" name="filter" value="unknown"><label for="option">Unknown DIARs</label> <br>
					<input  type="radio" name="filter" value="both" checked="true"><label for="option">Both</label>   <br>
			</div>
			<!-- style= "float:left; width:200px; margin-right:10px;padding:10px;"" -->
			<div class="headerBoxes">
					<p style= "-webkit-margin-after:0px !important; -webkit-margin-before:0px !important">
					<label class= "white_color" for="nRadius" 
							style="display: inline-block; text-align: left">
							Selected Score: <span id="nScore_value"></span>
					</label>
					<input class= "white_color" type="range" min="-0.1" max="0.7" step="0.01" value="0.6" id="nScore">
					<div>  <span class= "white_color" style="float:left;">min</span>  <span style="float:right; padding-right:80px">max </span> </div>
					</p>
				&nbsp;
			</div>	

			<div class="headerBoxes">
				<p style= "-webkit-margin-after:0px !important;-webkit-margin-before:0px !important;"> Select Score Criteria:  </p>	
				<input  type="radio" name="score_filter" value="known"> Support <br>
				<input  type="radio" name="score_filter" value="unknown"> Confidence <br>
				<input  type="radio" name="score_filter" value="both" checked="true" > Reporting Ratio <br>
			</div>

			<!-- <div id="div_legends" class="headerBoxes" style=" border:0px solid #fff;">
				<div id="legend" class = "div_outline">  </div>
			</div>  -->

			<div class="headerBoxes">
				<svg id="legend_svg" height="20" width="195"></svg>
				<div style="padding-right:80px">  
					<span style="float:left">Low Score </span>  
					<span style="float:right">High </span> 
				</div>
				<svg id="legend_svg_severity" height="20" width="195"></svg>
				<div style="padding-right:80px"> <span style="float:left">DDI Conf</span> 
					 <span style="float:right">Drug Conf </span> 
				</div>

			</div>	
			<div class="headerBoxes">
				Search: <input id="search_txbox" type="text" name="Search" value="Search"  onfocus="if (this.value == 'Search') {this.value = '';}" onblur="if (this.value == '') {this.value = 'Search';}" ><br> 
			</div>	
		</div>			
	</div>


	<!-- allowOverflow auto-attached by option: west__showOverflowOnHover = true -->
	<div id = "div_graph" class="ui-layout-west">
		<button id="max_overivew" onclick="toggleMaximize('west')" style="position:fixed;"> &#x271A;</button>
		<h2 class="header_font"> Overview of all DDIs </h2>
	</div>

<div class="ui-layout-east">
      <div id = "div_table">
        <button onclick="myLayout.toggle('east')"  style="position:fixed;">&#x2716;</button>
        <button id="view_reports" onclick="toggleMaximize('east')" style="position:fixed;" >&#x271A;</button>
        <h2 id= "report_heading" class="header_font"> Reports relevant to Drug: Furosemide  </h2>
     </div>
</div>

<div class="ui-layout-center">
		<div  id="galaxy">
				<button id="toggleAllPanes" style="position:fixed">&#x271A;</button>			
				<h2 id= "galaxy_heading" class="header_font"> Overview of score glyphs for Furosemide </h2>
                <div id="vis"></div>
       </div>              
</div>

</body>
</html>

<script src="scripts/zoom.js"></script>
<script src="scripts/glyph.js"></script>
<script>
  var main_drug_radius = 5;
  var known_r = 3;
  var unknown_r = 6;
  var main_drug_color=  "#2196f3"  ;//"green"
  var default_link_color = '#FAEBD7'; //'#fe9929'

  var min_score = -0.1;
  var max_score = 1;

   /*color comain for the legends*/
  var color = d3.scale.linear()
                  .domain([min_score, (min_score+max_score)/2, max_score])
                  // .range(["#fcae91","#de2d26", "#a50f15"]);
                  .range(["hsl(0, 100%, 80%)", "hsl(0, 100%, 64%)","hsl(0, 100%, 25%)"]);
                  // .range(["#fee0d2","#fc9272", "#de2d26"]);
                  // .range(["grey", "#fb6a4a", "red"]);
                  // .range(["#cb181d","#fcae91","#fee5d9"])  


  var color_severity = d3.scale.linear()
                          .domain([0,1,5])
                          // .range(["#fed98e", "#a6bddb", "#2b8cbe"]);
                          .range(["#fed98e", '#a3a3c2', '#666699']);

  var threshold = d3.scale.quantize()
    .domain([-0.1, 0, 1,0.01, 0.1])
    .range(["#fecc5c", "#fd8d3c", "#f03b20", "#800000"]);

  var x = d3.scale.linear()
    .domain([0, 1])
    .range([0, 240]);

  var xAxis = d3.svg.axis()
			  .orient("bottom")
			  .tickSize(13)
			  .tickValues(threshold.domain())
			  .tickFormat(function(d) { return d === 0.5 ? formatPercent(d) : formatNumber(100 * d); });

  var g = d3.select("#legend_svg").append("g")


  g.select("g").call(xAxis)
  g.select(".domain")
   .remove();


        
g.selectAll("rect")
  .data(threshold.range().map(function(color) {
    var d = threshold.invertExtent(color);
    return d;
  }))
  .enter().insert("rect", ".tick")
  .attr("height", 20)
  .attr("width", 45)
  .attr("x", function(d,i) { //console.log(i); 
    	return i*45; })
  .attr("fill", function(d) { return threshold(d[0]); });

	/*############### Legend for the DME #################*/          
var formatPercent = d3.format(".0%"),
formatNumber = d3.format(".0f");

var sev_threshold = d3.scale.quantize()
    // .domain([0.11, 0.22, 0.33, 0.50])
    .range(["#016c59", '#016c59', '', '', '#d0d1e6','#d0d1e6']);

var sev_g = d3.select("#legend_svg_severity").append("g")


sev_g.select("g").call(xAxis)
sev_g.select(".domain")
    .remove();


        
sev_g.selectAll("rect")
     .data(sev_threshold.range().map(function(color) {
   	 var d = sev_threshold.invertExtent(color);
   	 return d;
     }))
    .enter().insert("rect", ".tick")
    .attr("height", 20)
    .attr("width", 30)
    .attr("x", function(d,i) { //console.log(i); 
    	return i*30; })
    .attr("fill", function(d,i) { 
		if (i===0 || i===5 || i===4 || i===1) return sev_threshold(d[0])
		else return '#0a0a67'
     });           

  </script>

